<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Чатег</title>
    <style>
        #messages {
            font-family: sans-serif;
            width: 40rem;
            border-left: solid 2px #eee;
            padding: 1rem;
        }
        .system-message, .user-message {
            margin: .5rem;
        }
        .system-message {
            text-align: center;
            font-size: 80%;
            color: #666;
        }
        .user-message {
            text-align: left;
        }
    </style>
</head>
<body>
<div id="messages"></div>

<script>
    let ws = new WebSocket(location.origin.replace(/^http/, "ws") + "/ws?name=test123");
    let messages = document.getElementById('messages');

    ws.onopen = function (event) {
        window.setTimeout(function () {
            ws.send(JSON.stringify({
                "text": "Всем чмоки в этом чате!"
            }));
        }, 4000);
    };

    ws.onmessage = function (event) {
        let data = JSON.parse(event.data);

        console.log('message:', data);

        if (data.typing === true) {
            return
        }

        if (data.name !== undefined) {
            messages.innerHTML += `<div class="user-message"><strong>${data.name}:</strong> ${data.text}<div>`;
        } else {
            messages.innerHTML += `<div class="system-message">${data.text}<div>`;
        }
    };
</script>
</body>
</html>
